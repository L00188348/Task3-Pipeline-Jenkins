/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2025 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

const API_BASE="/api/tasks";class TaskManager{constructor(){this.tasks=[],this.init()}init(){this.loadTasks(),this.setupEventListeners()}async loadTasks(){try{const e=await fetch(API_BASE);var t=await e.json();t.success&&(this.tasks=t.data,this.updateDashboard(),this.checkAndRenderTables())}catch(t){console.error("Error loading tasks:",t)}}checkAndRenderTables(){document.getElementById("tasks-table-body")&&this.renderTasks()}updateDashboard(){const t=document.getElementById("total-tasks");var e,s,a,n;t&&(e=this.tasks.length,s=this.tasks.filter(t=>"pending"===t.status).length,a=this.tasks.filter(t=>"in-progress"===t.status).length,n=this.tasks.filter(t=>"completed"===t.status).length,t.textContent=e,document.getElementById("pending-tasks").textContent=s,document.getElementById("progress-tasks").textContent=a,document.getElementById("completed-tasks").textContent=n)}renderTasks(){const e=document.getElementById("tasks-table-body");e?(e.innerHTML="",this.tasks.forEach(t=>{t=this.createTaskRow(t);e.appendChild(t)}),this.setupEditListeners(),this.setupDeleteListeners()):console.log("Table not found - not on tables page")}createTaskRow(t){const e=document.createElement("tr");var s=new Date(t.created_at).toLocaleDateString("en-US"),a=this.getStatusBadge(t.status),n=this.getPriorityBadge(t.priority);return e.innerHTML=`
            <td>${t.title}</td>
            <td>${t.description||"-"}</td>
            <td>${a}</td>
            <td>${n}</td>
            <td>${s}</td>
            <td>
                <button class="btn btn-sm btn-primary edit-task" data-id="${t.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-task" data-id="${t.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `,e}getStatusBadge(t){return{pending:'<span class="badge badge-warning">Pending</span>',"in-progress":'<span class="badge badge-info">In Progress</span>',completed:'<span class="badge badge-success">Completed</span>'}[t]||'<span class="badge badge-secondary">Unknown</span>'}getPriorityBadge(t){return{low:'<span class="badge badge-success">Low</span>',medium:'<span class="badge badge-warning">Medium</span>',high:'<span class="badge badge-danger">High</span>'}[t]||'<span class="badge badge-secondary">Unknown</span>'}setupEventListeners(){const t=document.getElementById("saveTask");t&&t.addEventListener("click",()=>this.handleSaveTask());const e=document.getElementById("taskForm");e&&e.addEventListener("submit",t=>{t.preventDefault(),this.handleSaveTask()});const s=document.getElementById("filter-pending"),a=document.getElementById("filter-progress"),n=document.getElementById("filter-completed");s&&s.addEventListener("click",()=>this.filterTasks("pending")),a&&a.addEventListener("click",()=>this.filterTasks("in-progress")),n&&n.addEventListener("click",()=>this.filterTasks("completed"))}handleSaveTask(){var t=document.getElementById("taskId").value,e=document.getElementById("taskTitle").value.trim(),s=document.getElementById("taskDescription").value.trim(),a=document.getElementById("taskStatus").value,n=document.getElementById("taskPriority").value;e?(n={title:e,description:s,status:a,priority:n},t?this.updateTask(t,n):this.createTask(n)):this.showAlert("Title is required!","warning")}async createTask(t){try{const s=await fetch(API_BASE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});var e=await s.json();e.success?($("#taskModal").modal("hide"),document.getElementById("taskForm").reset(),this.loadTasks(),this.showAlert("Task created successfully!","success")):this.showAlert("Error creating task: "+e.message,"danger")}catch(t){console.error("Error creating task:",t),this.showAlert("Error connecting to server","danger")}}async deleteTask(t){if(confirm("Are you sure you want to delete this task?"))try{const s=await fetch(`${API_BASE}/${t}`,{method:"DELETE"});var e=await s.json();e.success?(this.showAlert("Task deleted successfully!","success"),this.loadTasks()):this.showAlert("Error deleting task: "+e.message,"danger")}catch(t){console.error("Error deleting task:",t),this.showAlert("Error connecting to server","danger")}}editTask(e){var t=this.tasks.find(t=>t.id==e);t&&(document.getElementById("taskId").value=t.id,document.getElementById("taskTitle").value=t.title,document.getElementById("taskDescription").value=t.description||"",document.getElementById("taskStatus").value=t.status,document.getElementById("taskPriority").value=t.priority,document.getElementById("taskModalLabel").textContent="Edit Task",document.getElementById("saveTask").textContent="Update Task",$("#taskModal").modal("show"))}async updateTask(t,e){try{const a=await fetch(`${API_BASE}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});var s=await a.json();s.success?($("#taskModal").modal("hide"),document.getElementById("taskForm").reset(),this.loadTasks(),this.showAlert("Task updated successfully!","success")):this.showAlert("Error updating task: "+s.message,"danger")}catch(t){console.error("Error updating task:",t),this.showAlert("Error connecting to server","danger")}}setupEditListeners(){const t=document.querySelectorAll(".edit-task");t.forEach(t=>{t.addEventListener("click",t=>{t=t.target.closest(".edit-task").dataset.id;this.editTask(t)})})}setupDeleteListeners(){const t=document.querySelectorAll(".delete-task");t.forEach(t=>{t.addEventListener("click",t=>{t=t.target.closest(".delete-task").dataset.id;this.deleteTask(t)})})}showAlert(t,e){const s=document.createElement("div");s.className=`alert alert-${e} alert-dismissible fade show`,s.innerHTML=`
            ${t}
            <button type="button" class="close" data-dismiss="alert">
                <span>&times;</span>
            </button>
        `;const a=document.querySelector("#content");a.insertBefore(s,a.firstChild),setTimeout(()=>{s.remove()},5e3)}filterTasks(e){var t=this.tasks.filter(t=>t.status===e);this.renderFilteredTasks(t,e)}renderFilteredTasks(t,e){const s=document.getElementById("tasks-table-body");s&&(s.innerHTML="",0!==t.length?(t.forEach(t=>{t=this.createTaskRow(t);s.appendChild(t)}),this.setupDeleteListeners()):s.innerHTML=`
                <tr>
                    <td colspan="6" class="text-center">
                        No ${e} tasks found
                    </td>
                </tr>
            `)}setupModalReset(){$("#taskModal").on("hidden.bs.modal",()=>{document.getElementById("taskForm").reset(),document.getElementById("taskId").value="",document.getElementById("taskModalLabel").textContent="New Task",document.getElementById("saveTask").textContent="Save Task"})}}document.addEventListener("DOMContentLoaded",function(){window.taskManager=new TaskManager});