/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2025 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

let API_BASE="/api/tasks";class TaskManager{constructor(){this.tasks=[],this.init()}init(){this.loadTasks(),this.setupEventListeners()}async loadTasks(){try{var e=await(await fetch(API_BASE)).json();e.success&&(this.tasks=e.data,this.updateDashboard(),this.checkAndRenderTables())}catch(e){console.error("Error loading tasks:",e)}}checkAndRenderTables(){document.getElementById("tasks-table-body")&&this.renderTasks()}updateDashboard(){var e,t,s,a,n=document.getElementById("total-tasks");n&&(e=this.tasks.length,t=this.tasks.filter(e=>"pending"===e.status).length,s=this.tasks.filter(e=>"in-progress"===e.status).length,a=this.tasks.filter(e=>"completed"===e.status).length,n.textContent=e,document.getElementById("pending-tasks").textContent=t,document.getElementById("progress-tasks").textContent=s,document.getElementById("completed-tasks").textContent=a)}renderTasks(){let t=document.getElementById("tasks-table-body");t?(t.innerHTML="",this.tasks.forEach(e=>{e=this.createTaskRow(e);t.appendChild(e)}),this.setupEditListeners(),this.setupDeleteListeners()):console.log("Table not found - not on tables page")}createTaskRow(e){var t=document.createElement("tr"),s=new Date(e.created_at).toLocaleDateString("en-US"),a=this.getStatusBadge(e.status),n=this.getPriorityBadge(e.priority);return t.innerHTML=`
            <td>${e.title}</td>
            <td>${e.description||"-"}</td>
            <td>${a}</td>
            <td>${n}</td>
            <td>${s}</td>
            <td>
                <button class="btn btn-sm btn-primary edit-task" data-id="${e.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-task" data-id="${e.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `,t}getStatusBadge(e){return{pending:'<span class="badge badge-warning">Pending</span>',"in-progress":'<span class="badge badge-info">In Progress</span>',completed:'<span class="badge badge-success">Completed</span>'}[e]||'<span class="badge badge-secondary">Unknown</span>'}getPriorityBadge(e){return{low:'<span class="badge badge-success">Low</span>',medium:'<span class="badge badge-warning">Medium</span>',high:'<span class="badge badge-danger">High</span>'}[e]||'<span class="badge badge-secondary">Unknown</span>'}setupEventListeners(){var e=document.getElementById("saveTask"),e=(e&&e.addEventListener("click",()=>this.handleSaveTask()),document.getElementById("taskForm")),e=(e&&e.addEventListener("submit",e=>{e.preventDefault(),this.handleSaveTask()}),document.getElementById("filter-pending")),t=document.getElementById("filter-progress"),s=document.getElementById("filter-completed");e&&e.addEventListener("click",()=>this.filterTasks("pending")),t&&t.addEventListener("click",()=>this.filterTasks("in-progress")),s&&s.addEventListener("click",()=>this.filterTasks("completed"))}handleSaveTask(){var e=document.getElementById("taskId").value,t=document.getElementById("taskTitle").value.trim(),s=document.getElementById("taskDescription").value.trim(),a=document.getElementById("taskStatus").value,n=document.getElementById("taskPriority").value;t?(t={title:t,description:s,status:a,priority:n},e?this.updateTask(e,t):this.createTask(t)):this.showAlert("Title is required!","warning")}async createTask(e){try{var t=await(await fetch(API_BASE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();t.success?($("#taskModal").modal("hide"),document.getElementById("taskForm").reset(),this.loadTasks(),this.showAlert("Task created successfully!","success")):this.showAlert("Error creating task: "+t.message,"danger")}catch(e){console.error("Error creating task:",e),this.showAlert("Error connecting to server","danger")}}async deleteTask(e){if(confirm("Are you sure you want to delete this task?"))try{var t=await(await fetch(API_BASE+"/"+e,{method:"DELETE"})).json();t.success?(this.showAlert("Task deleted successfully!","success"),this.loadTasks()):this.showAlert("Error deleting task: "+t.message,"danger")}catch(e){console.error("Error deleting task:",e),this.showAlert("Error connecting to server","danger")}}editTask(t){var e=this.tasks.find(e=>e.id==t);e&&(document.getElementById("taskId").value=e.id,document.getElementById("taskTitle").value=e.title,document.getElementById("taskDescription").value=e.description||"",document.getElementById("taskStatus").value=e.status,document.getElementById("taskPriority").value=e.priority,document.getElementById("taskModalLabel").textContent="Edit Task",document.getElementById("saveTask").textContent="Update Task",$("#taskModal").modal("show"))}async updateTask(e,t){try{var s=await(await fetch(API_BASE+"/"+e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();s.success?($("#taskModal").modal("hide"),document.getElementById("taskForm").reset(),this.loadTasks(),this.showAlert("Task updated successfully!","success")):this.showAlert("Error updating task: "+s.message,"danger")}catch(e){console.error("Error updating task:",e),this.showAlert("Error connecting to server","danger")}}setupEditListeners(){document.querySelectorAll(".edit-task").forEach(e=>{e.addEventListener("click",e=>{e=e.target.closest(".edit-task").dataset.id;this.editTask(e)})})}setupDeleteListeners(){document.querySelectorAll(".delete-task").forEach(e=>{e.addEventListener("click",e=>{e=e.target.closest(".delete-task").dataset.id;this.deleteTask(e)})})}showAlert(e,t){let s=document.createElement("div");s.className=`alert alert-${t} alert-dismissible fade show`,s.innerHTML=`
            ${e}
            <button type="button" class="close" data-dismiss="alert">
                <span>&times;</span>
            </button>
        `;t=document.querySelector("#content");t.insertBefore(s,t.firstChild),setTimeout(()=>{s.remove()},5e3)}filterTasks(t){var e=this.tasks.filter(e=>e.status===t);this.renderFilteredTasks(e,t)}renderFilteredTasks(e,t){let s=document.getElementById("tasks-table-body");s&&(s.innerHTML="",0===e.length?s.innerHTML=`
                <tr>
                    <td colspan="6" class="text-center">
                        No ${t} tasks found
                    </td>
                </tr>
            `:(e.forEach(e=>{e=this.createTaskRow(e);s.appendChild(e)}),this.setupDeleteListeners()))}setupModalReset(){$("#taskModal").on("hidden.bs.modal",()=>{document.getElementById("taskForm").reset(),document.getElementById("taskId").value="",document.getElementById("taskModalLabel").textContent="New Task",document.getElementById("saveTask").textContent="Save Task"})}}document.addEventListener("DOMContentLoaded",function(){window.taskManager=new TaskManager});